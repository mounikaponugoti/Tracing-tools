#	mProfile tool examples 

The main goal of this document is to show you how to use differnt flags available in *mProfile* tool with examples. Whenever possible, 
multiple commands which yield same results are shown for the clarification. <br/>
**Note:** This document does not show all the possible combinations of the flags.

In the below examples, shell command `cat` is used as a test program to run under *mProfile* tool in case of single theread. The content 
of the text file `test.txt` used to run with `cat` command is shown below:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-bash-4.2$ cat test.txt
Welcome to mProfile Tutorial!!
This is a test file.
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

* By default, recording and writing the trace descriptors to a file is turned off. Hence, in this example *mProfile* captures
the control flow statistics while running `cat` shell command.

  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  -bash-4.2$ pin -t obj-intel64/mProfile.so -mcf -- cat test.txt
  Or
  -bash-4.2$ pin -t obj-intel64/mProfile.so -- cat test.txt
  mProfile: thread begin 0 31722
  Welcome to mProfile Tutorial!!
  This is a test file.

  -bash-4.2$ ls
  makefile          mProfile.cpp                                  obj-intel64 
  makefile.rules    mProfile.h                                    test.txt
  mProfileAssist.h  mProfile.out2019_3_3_18.23.33_mcf.Statistics 
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  
  * Statistics file generated with `-mcf` (by default set) gives the control-flow instruction details of the program. 
  It gives number of branch instructions which are conditional (taken/not taken) and unconditional (direct and indirect).
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    -bash-4.2$ cat mProfile.out2019_3_3_18.23.33_mcf.Statistics
    Instrumentation Time: 903.173 ms
    Number of Threads: 1
    Traced 232994 instructions
    Skipped 0 instructions
    All The Threads Total Control Transfer Instructions: 51024
            21858 ( %42.84 ) Conditional Direct Taken
            22089 ( %43.29 ) Conditional Direct Not Taken
            4604 ( %9.02 ) Unconditional Direct
            2473 ( %4.85 ) Unconditional Indirect
                    1634 ( %66.07 ) Returns
                    839 ( %33.93 ) Other
    -- Thread 0 Total Control Transfer Instructions: 51024
            21858 ( %42.84 ) Conditional Direct Taken
            22089 ( %43.29 ) Conditional Direct Not Taken
            4604 ( %9.02 ) Unconditional Direct
            2473 ( %4.85 ) Unconditional Indirect
                    1634 ( %66.07 ) Returns
                    839 ( %33.93 ) Other
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    
* In this example, *mProfile* record the traces for control-flow instructions while running `cat` shell command. 
The recorded traces are written to a text file in ASCII format. When `-a` is not set, recorded traces are written 
to a binary file. Regardless of whether tracing is on or not, statistics corresponds to control-flow and/or data-flow 
instructions are collected and written to the statistics file.
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  -bash-4.2$ pin -t obj-intel64/mProfile.so -mcf -trace -a -- cat test.txt

  mProfile: Writing control flow traces to text file: mProfile.out2019_3_3_18.27.1_mcf.txt
  Profile descriptor: ThreadID, Instruction Address, Target Address, Conditional or Unconditional, 
  Direct or Indirect, Outcome

  mProfile: thread begin 0 31735
  Welcome to mProfile Tutorial!!
  This is a test file.
  
  # Trace and statistic files generated by the mProfile tool
  -bash-4.2$ ls mProfile.out2019_*
  mProfile.out2019_3_3_18.27.1_mcf.Statistics  mProfile.out2019_3_3_18.27.1_mcf.txt

  # Statistics file 
  -bash-4.2$ cat mProfile.out2019_3_3_18.27.1_mcf.Statistics
  Instrumentation Time: 1043.56 ms
  Number of Threads: 1
  Traced 232994 instructions
  Skipped 0 instructions
  All The Threads Total Control Transfer Instructions: 51024
          21858 ( %42.84 ) Conditional Direct Taken
          22089 ( %43.29 ) Conditional Direct Not Taken
          4604 ( %9.02 ) Unconditional Direct
          2473 ( %4.85 ) Unconditional Indirect
                  1634 ( %66.07 ) Returns
                  839 ( %33.93 ) Other
  -- Thread 0 Total Control Transfer Instructions: 51024
          21858 ( %42.84 ) Conditional Direct Taken
          22089 ( %43.29 ) Conditional Direct Not Taken
          4604 ( %9.02 ) Unconditional Direct
          2473 ( %4.85 ) Unconditional Indirect
                  1634 ( %66.07 ) Returns
                  839 ( %33.93 ) Other
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  
  * For control-flow instructions, a trace record includes the thread id, instruction address, target address of the 
  control-flow instruction, whether the branch is conditional (C) or unconditional (U), whether the branch is direct (D) or 
  indirect (I), and whether the branch is taken (T) or not (NT). In case of binary traces, threadid is 1-byte, instruction 
  address is 8-bytes, branch target is 8-bytes, branch type and outcome is 1-byte long. 
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    -bash-4.2$ head mProfile.out2019_3_3_18.27.1_mcf.txt
    0, 0x00007fb1aa1b0c33, 0x00007fb1aa1b19b0, U, D, T
    0, 0x00007fb1aa1b19ff, 0x00007fb1aa1b1a92, C, D, NT
    0, 0x00007fb1aa1b1a41, 0x00007fb1aa1b1a5f, U, D, T
    0, 0x00007fb1aa1b1a63, 0x00007fb1aa1b1a48, C, D, T
    0, 0x00007fb1aa1b1a5d, 0x00007fb1aa1b1a92, C, D, NT
    0, 0x00007fb1aa1b1a63, 0x00007fb1aa1b1a48, C, D, T
    0, 0x00007fb1aa1b1a5d, 0x00007fb1aa1b1a92, C, D, NT
    0, 0x00007fb1aa1b1a63, 0x00007fb1aa1b1a48, C, D, NT
    0, 0x00007fb1aa1b1a6f, 0x00007fb1aa1b1c68, C, D, T
    0, 0x00007fb1aa1b1c70, 0x00007fb1aa1b1c90, C, D, T
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  
*	In this example, *mProfile* records the data-flow traces for `cat` shell command. To turn off the control-flow traces which 
are enabled by default, `-mcf` is set to 0. When `-mls` is set, by default memory read traces are recorded. Thus, the command given 
below only instruments and record traces for memory read instructions while executing `/bin/cat`. 
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    -bash-4.2$ pin -t obj-intel64/mProfile.so -mcf 0 -mls 1 -trace -a -- cat test.txt
    Or
    -bash-4.2$ pin -t obj-intel64/mProfile.so -mcf 0 -mls -trace -a -- cat test.txt
    mProfile: Writing data flow traces to text file: mProfile.out2019_3_3_18.31.0_mls.txt
    Profile descriptor: ThreadID, Instruction Address, Operand Address, Operand Size, Value
    mProfile: thread begin 0 31792
    Welcome to mProfile Tutorial!!
    This is a test file.

    # Trace and statistic file generated by the mProfile tool
    -bash-4.2$ ls mProfile.out2019_*
    mProfile.out2019_3_3_18.31.0_mls.Statistics  mProfile.out2019_3_3_18.31.0_mls.txt
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  
  * Statistics file generated with `-mls` gives the data-flow instruction details of the program. By default, it counts the
  number of load instructions and number of load operands which are 1-byte, 2-bytes (words), 4-bytes (double words), 8-bytes (quard words)
  10-bytes (extended precision), 32-bytes (octa words), and 64-bytes (hexa words) long.
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    -bash-4.2$ cat mProfile.out2019_3_3_18.31.0_mls.Statistics
    Instrumentation Time: 1547.18 ms
    Number of Threads: 1
    Traced 233022 instructions
    Traced 57491 load instructions
    Traced 17010 store instructions
    Skipped 0 instructions
    All The Threads Total Load Operands: 57487
            13846 ( %24.09 ) Byte Operands
            4302 ( %7.48 ) Word Operands
            7869 ( %13.69 ) DoubleWord Operands
            30115 ( %52.39 ) QuadWord Operands
            0 ( %0.00 ) Extended Precision Operands
            1179 ( %2.05 ) OctaWord Operands
            176 ( %0.31 ) HexaWord Operands
            0 ( %0.00 ) Operands of other size
    -- Thread 0 Total Load Operands: 57487
            13846 ( %24.09 ) Byte Operands
            4302 ( %7.48 ) Word Operands
            7869 ( %13.69 ) DoubleWord Operands
            30115 ( %52.39 ) QuadWord Operands
            0 ( %0.00 ) Extended Precision Operands
            1179 ( %2.05 ) OctaWord Operands
            176 ( %0.31 ) HexaWord Operands
            0 ( %0.00 ) Operands of other size
      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      
    * For data-flow instructions, a trace record includes the thread id, instruction address, operand address, operand size, 
    and operand value. In case of binary traces, threadid is 1-byte, instruction address is 8-bytes, operand address is 8-bytes, 
    operand size is 1-byte, operand value is size of operand size. 
      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      -bash-4.2$ head mProfile.out2019_3_3_18.31.0_mls.txt
      0, 0x00007fb9f5d8e9dd, 0x00007fb9f5fb2e70, 8, 0x000000000000000e
      0, 0x00007fb9f5d8e9e7, 0x00007fb9f5fb3000, 8, 0x0000000000225e70
      0, 0x00007fb9f5d8ea57, 0x00007fb9f5fb2e80, 8, 0x0000000000000004
      0, 0x00007fb9f5d8ea57, 0x00007fb9f5fb2e90, 8, 0x000000006ffffef5
      0, 0x00007fb9f5d8ea57, 0x00007fb9f5fb2ea0, 8, 0x0000000000000005
      0, 0x00007fb9f5d8ea57, 0x00007fb9f5fb2eb0, 8, 0x0000000000000006
      0, 0x00007fb9f5d8ea57, 0x00007fb9f5fb2ec0, 8, 0x000000000000000a
      0, 0x00007fb9f5d8ea57, 0x00007fb9f5fb2ed0, 8, 0x000000000000000b
      0, 0x00007fb9f5d8ea57, 0x00007fb9f5fb2ee0, 8, 0x0000000000000003
      0, 0x00007fb9f5d8ea57, 0x00007fb9f5fb2ef0, 8, 0x0000000000000002
      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*	In this example, *mProfile* instruments and records the traces for memory write instructions while executing `cat` shell 
command. To record the traces for only memory write instructions, `-load` is set to 0 and `-store` is set to 1 since `-load` 
is set by default when `-mls` is active.
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    -bash-4.2$ pin -t obj-intel64/mProfile.so -mcf 0 -mls 1 -load 0 -store 1 -trace -a -- cat test.txt
    Or
    -bash-4.2$ pin -t obj-intel64/mProfile.so -mcf 0 -mls -load 0 -store -trace -a -- cat test.txt

    mProfile: Writing data flow traces to text file: mProfile.out2019_3_3_18.36.8_mls.txt
    Profile descriptor: ThreadID, Instruction Address, Operand Address, Operand Size, Value
    mProfile: thread begin 0 31832
    Welcome to mProfile Tutorial!!
    This is a test file.

    # Trace and statistic file generated by the mProfile tool
    -bash-4.2$ ls mProfile.out2019_*
    mProfile.out2019_3_3_18.36.8_mls.Statistics  mProfile.out2019_3_3_18.36.8_mls.txt
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  
  * Trace format and statistics are of same for memory read (`-load`) and memory write instructions (`-store`).
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    -bash-4.2$ cat mProfile.out2019_3_3_18.36.8_mls.Statistics
    Instrumentation Time: 1420.08 ms
    Number of Threads: 1
    Traced 232994 instructions
    Traced 57479 load instructions
    Traced 17010 store instructions
    Skipped 0 instructions
    All The Threads Total Store Operands: 17674
            247 ( %1.40 ) Byte Operands
            98 ( %0.55 ) Word Operands
            1671 ( %9.45 ) DoubleWord Operands
            15306 ( %86.60 ) QuadWord Operands
            0 ( %0.00 ) Extended Precision Operands
            176 ( %1.00 ) OctaWord Operands
            176 ( %1.00 ) HexaWord Operands
            0 ( %0.00 ) Operands of other size
    -- Thread 0 Total Store Operands: 17674
            247 ( %1.40 ) Byte Operands
            98 ( %0.55 ) Word Operands
            1671 ( %9.45 ) DoubleWord Operands
            15306 ( %86.60 ) QuadWord Operands
            0 ( %0.00 ) Extended Precision Operands
            176 ( %1.00 ) OctaWord Operands
            176 ( %1.00 ) HexaWord Operands
            0 ( %0.00 ) Operands of other size

    # Trace file 
    -bash-4.2$ head mProfile.out2019_3_3_18.36.8_mls.txt
    0, 0x00007f49b27f6c33, 0x00007fffd2d01828, 8, 0x00007f49b27f6c38
    0, 0x00007f49b27f79b0, 0x00007fffd2d01820, 8, 0x0000000000000000
    0, 0x00007f49b27f79b4, 0x00007fffd2d01818, 8, 0x0000000000000000
    0, 0x00007f49b27f79b6, 0x00007fffd2d01810, 8, 0x0000000000000000
    0, 0x00007f49b27f79b8, 0x00007fffd2d01808, 8, 0x0000000000000000
    0, 0x00007f49b27f79ba, 0x00007fffd2d01800, 8, 0x0000000000000000
    0, 0x00007f49b27f79bf, 0x00007fffd2d017f8, 8, 0x0000000000000000
    0, 0x00007f49b27f79d6, 0x00007f49b2a1bc60, 8, 0x0007abcaa70f78a8
    0, 0x00007f49b27f79ee, 0x00007f49b2a1c9e8, 8, 0x00007f49b2a1be70
    0, 0x00007f49b27f79f8, 0x00007f49b2a1c9d8, 8, 0x00007f49b27f6000
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  
